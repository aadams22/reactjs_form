<html>
<head>
  <title></title>
  <link rel="stylesheet" type="text/css" href="./styles/main.css">
</head>
<body>
<div id="login-container"></div>

    <script src="https://fb.me/react-15.0.0.js"></script>
    <script src="https://fb.me/react-dom-15.0.0.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
    <script type="text/babel">

      var data = [];

      var FormInput = React.createClass({
          getInitialState: function() {
            return {
              firstname: '', 
              email: '',
              failedInput: '',
              isvalid: true,
              canSubmit: false,
              success: false
            };
          },
          handleNameChange: function(e) {
            this.setState({firstname: e.target.value});

            if(e.target.value){
              this.validateName(e.target.value)
            }
            
            console.log("target: ", e.target.value );

          },
          handleEmailChange: function(e) {
            this.setState({email: e.target.value});
            // this.validateEmail(e.target.value)
          },       
          validateEmail: function(state) {
            /*would probably use a stronger regex and include sending an email for physical validation*/
            console.log("email test: ", /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(state.email))

            if(this.state.isvalid) {
              console.log('state', this.state)
              this.setState({ failedInput: 'email', isvalid: false });
            }

          },
          validateName: function(state) {
            //Tests for only letters in name. !!need to include languages other than english!

            var t = /^[a-zA-Z]*$/.test(this.state.firstname);
            console.log('test: ', t);

            if(!t) {
              this.setState({ 
                failedInput: 'name',
                isvalid: false
               });
              console.log('state', this.state)
            }

          },
          handleSubmit: function(e) {
            e.preventDefault();


            var firstName  = this.state.firstname.trim();
            var email      = this.state.email.trim();


            /*Normally an AJAX call would be here sending the data to the server, on success the data array would be updated, but since we're dealing with only 2 pieces of information and no db, no array or ajax call is necessary*/


            /*If the sate is valid after submit, then the data can be submited. The two are necessary to keep the form from submitting while the isvalid state is still true at the inital rendering*/
            if (this.state.isvalid) { this.setState({canSubmit: true}); }


            if(this.state.canSubmit) {
              data.push({'firstName': firstName, 'email': email});
              console.log('data: ', data); 
              this.setState({success: true}); 
            }


            /*on a successful ajax call, this should be the final code to reset inupts to empty values
            return this.setState({firstname: '', email: '', success: false});*/
          },
          //I think I should refactor the conditional statemnts to be set as disabled classes
          render: function() {
              return (
                <div>

                  {this.state.success ? 
                    <UserData 
                      firstname={this.state.firstname} 
                      email={this.state.email} /> : null
                  }

                  {!this.state.isvalid ? 
                    <ValidationErr failedInput={this.state.failedInput} /> : null 
                  }


                  {!this.state.success &&
                    <form onSubmit={ this.handleSubmit }>
                      <input type="text" 
                              placeholder="Name"
                              value={this.state.firstname}                         
                              onChange={this.handleNameChange} />
                      <br /><br />
                      <input type="email" 
                             placeholder="example@example.com"
                             value={this.state.email}
                             onChange={this.handleEmailChange}
                             required  />
                      <br /><br />
                      <input type="submit" value="Post" ></input>
                    </form>
                  }

                </div>
              
              );
          }

        });
      


      var UserData = React.createClass({
        render: function() {
          return (
            <div id="error-handler">
              <h1>We appreciate your support!</h1>
              <h2>{this.props.firstname}</h2>
              <p>{this.props.email}</p>
            </div>
          )
        }

      });
 


      var ValidationErr = React.createClass({
        render: function() {
          return (
            <div id="error-handler" >
              <p>Sorry! Something seems to have gone awry. Please enter your proper {this.props.failedInput}!</p>
            </div>
          )
        }
      });


      ReactDOM.render(
        <FormInput/>,
        document.getElementById('login-container')
      );

      </script>
</body>
</html>