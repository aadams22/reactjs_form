<html>
<head>
  <title></title>
  <link rel="stylesheet" type="text/css" href="./styles/main.css">
</head>
<body>
<div id="login-container"></div>

    <script src="https://fb.me/react-15.0.0.js"></script>
    <script src="https://fb.me/react-dom-15.0.0.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
    <script type="text/babel">

      var data = [];

      var FormInput = React.createClass({
          getInitialState: function() {
            return {
              firstname: '', 
              email: '',
              failedInput: '',
              isvalid: true,
              success: false
            };
          },
          handleNameChange: function(e) {
            this.setState({firstname: e.target.value});
            /*if the value is not null, run instant validation while user is typing. 
            could also put this validation function after submit to stay in format with how I'm validating the email*/
            if(e.target.value){
              this.validateName(e.target.value)
            }

          },
          handleEmailChange: function(e) {
            this.setState({email: e.target.value});
          },
          validateName: function(state) {
            //Tests for only letters in name. !!need to include languages other than english!
            var t = /^[a-zA-Z]*$/.test(this.state.firstname);

            if(!t) {
              this.setState({ failedInput: 'name', isvalid: false });
            }else {
              this.setState({ failedInput: '', isvalid: true });
            }

          },       
          validateEmail: function(state) {
            /*would probably use a stronger regex and include sending an email for physical validation*/
            console.log("test: ", /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(this.state.email))

            console.log("email: ", this.state.email);

            if(this.state.isvalid) {
              this.setState({ failedInput: 'email', isvalid: false });
              console.log('state', this.state)
            }else {
              this.setState({ failedInput: '', isvalid: true });
            }

          },
          handleSubmit: function(e) {
            e.preventDefault();

            var firstName  = this.state.firstname.trim();
            var email      = this.state.email.trim();

            if(email) { this.validateEmail(email); }

            /*Normally an AJAX call would be here sending the data to the server, on success the data array would be updated, but since we're dealing with only 2 pieces of information and no db, no array or ajax call is necessary*/

            if(this.state.isvalid) {
              data.push({'firstName': firstName, 'email': email});
              console.log('data: ', data); 
              this.setState({success: true}); 
            }


            /*on a successful ajax call, this should be the final code to reset inupts to their original values
            return this.setState({firstname: '', email: '', success: false});*/
          },
          render: function() {
              return (
                <div>

                  {this.state.success ? 
                    <UserData 
                      firstname={this.state.firstname} 
                      email={this.state.email} /> :

                    <form onSubmit={ this.handleSubmit }>
                      <input type="text" 
                              placeholder="Name"
                              value={this.state.firstname}                         
                              onChange={this.handleNameChange}
                              required />
                      <br /><br />
                      <input type="email" 
                             placeholder="example@example.com"
                             value={this.state.email}
                             onChange={this.handleEmailChange} />
                      <br /><br />
                      <input type="submit" value="Post" ></input>
                    </form>
                  }

                  {!this.state.isvalid ? 
                    <ValidationErr failedInput={this.state.failedInput} /> : null 
                  }

                </div>
              
              );
          }

        });
      

      var UserData = React.createClass({
        render: function() {
          return (
            <div id="error-handler">
              <h1>We appreciate your support!</h1>
              <h2>{this.props.firstname}</h2>
              <p>{this.props.email}</p>
            </div>
          )
        }

      });
 

      var ValidationErr = React.createClass({
        render: function() {
          return (
            <div id="error-handler" >
              <p>Oh no! Something seems to have gone dreadfully awry. Please enter your proper {this.props.failedInput}!</p>
            </div>
          )
        }
      });


      ReactDOM.render(
        <FormInput/>,
        document.getElementById('login-container')
      );

      </script>
</body>
</html>